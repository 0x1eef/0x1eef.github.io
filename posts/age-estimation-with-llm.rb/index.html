<!DOCTYPE html>
<HTML lang="en">
<HEAD>
  <META name="generator" content=
  "HTML Tidy for HTML5 for FreeBSD version 5.8.0">
  <TITLE>@0x1eef's personal website</TITLE>
  <META charset="utf-8">
  <META name="viewport" content=
  "width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <LINK rel="icon" sizes="16x16" href="/images/favicon-16x16.png">
  <LINK rel="icon" sizes="32x32" href="/images/favicon-32x32.png">
  <LINK rel="icon" sizes="48x48" href="/images/favicon-48x48.png">
  <LINK rel="icon" sizes="64x64" href="/images/favicon-64x64.png">
  <LINK rel="icon" sizes="128x128" href="/images/favicon-128x128.png">
  <LINK rel="icon" sizes="256x256" href="/images/favicon-256x256.png">
  <LINK rel="stylesheet" href="/css/main.css">
  <SCRIPT src="/js/prism.js" async></SCRIPT>
  <LINK rel="stylesheet" href="/css/prism/github.css">
  <LINK rel="stylesheet" href="/css/prism/tomorrownight.css">
  <META property="og:type" content="article">
  <META property="og:title" content=
  "How to estimate the age of a person in a photo">
  <META property="og:description" content=
  "Documents how to estimate the age of a person in a photo with llm.rb">
  <META property="og:url" content=
  "https://0x1eef.github.io/posts/an-introduction-to-rag-with-llm.rb">
  <META property="og:image" content="https://0x1eef.github.io/images/og.png">
  <META property="og:image:type" content="image/png">
  <META property="og:image:width" content="512">
  <META property="og:image:height" content="512">
</HEAD>
<BODY class="hidden">
  <HEADER class="main-header">
    <IMG src="/images/og.png" alt="Leaf Logo" class="nav-logo">
    <NAV>
      <UL>
        <LI>
          <A href="/">HOME</A>
        </LI>
        <LI>
          <A href="/posts">POSTS</A>
        </LI>
      </UL>
    </NAV><BUTTON id="theme-toggle" aria-label="Toggle dark mode"><SPAN class=
    "theme-icon-sun" aria-hidden="true">‚òÄ</SPAN> <SPAN class="theme-icon-moon"
    aria-hidden="true">üåô</SPAN></BUTTON>
  </HEADER>
  <MAIN>
    <DIV>
      <H2>About</H2>
      <P>This post looks at how we can use the <A href=
      "https://github.com/llmrb/llm#readme">llm.rb</A> library to build a tool
      for estimating the age of a person in a photo. The demo combines three
      features at once ‚Äì multimodal prompts, vision (image understanding and
      generation), and structured outputs with JSON schema.</P>
      <H2>Background</H2>
      <H4>Context</H4>
      <P>After spending some time with large language models, I got curious
      about their vision capabilities ‚Äì in particular I wanted to know whether
      I could use Ruby to estimate someone‚Äôs age from a photo, and get a
      structured, machine-friendly answer. I also wanted to see what was
      possible with a minimalist library like <A href=
      "https://github.com/llmrb/llm#readme">llm.rb</A>.</P>
      <H2>Example</H2>
      <H4>Context</H4>
      <P>llm.rb supports models that can see images, not just text, and gives
      you a way to describe exactly what kind of output you want back. You can
      hand the model an image (as a URL is easiest), and a schema describing
      what keys to return. For this demo, I wanted the estimated age, the
      model's confidence (from 0.0 to 1.0), and any textual notes.</P>
      <P>I also decided to generate a test image on the fly‚Äìfinding good public
      domain portraits is surprisingly tricky, and this makes the whole demo
      self-contained:</P>
      <PRE><CODE class="language-ruby">require "llm"

llm = LLM.openai(key: ENV["OPENAI_SECRET"])
schema = llm.schema.object(
  age: llm.schema.integer.required.description("The age of the person in a photo"),
  confidence: llm.schema.number.required.description("Model confidence (0.0 to 1.0)"),
  notes: llm.schema.string.required.description("Model notes or caveats")
)

img = llm.images.create(prompt: "A man in his 30s")
bot = LLM::Bot.new(llm, schema:)
bot.chat URI(img.urls[0])

res = bot.messages.find(&amp;:assistant?).content!
print "age: ", res["age"], "\n"
print "confidence: ", res["confidence"], "\n"
print "notes: ", res["notes"], "\n"

# age: 32
# confidence: 0.89
# notes: The man appears to be in his early thirties ...
</CODE></PRE>
      <H4>Explanation</H4>
      <UL>
        <LI>The schema describes the output we want: age, confidence (as a
        number between 0.0 and 1.0), and notes.</LI>
        <LI>We generate a sample image on the fly, using the model‚Äôs built-in
        image generation.</LI>
        <LI>The bot is set up with the schema and asked to ‚Äúlook‚Äù at the image
        (via its URL).</LI>
        <LI>The response is strictly structured‚Äìeasy to use in further
        scripts.</LI>
      </UL>
      <H2>Caveats</H2>
      <P>Model-based age estimation is always approximate. The result here
      shouldn‚Äôt be trusted for real-world decisions or sensitive applications,
      and it's important to be mindful of privacy or ethical implications when
      analyzing images of real people.</P>
      <H2>Conclusion</H2>
      <P>With <A href="https://github.com/llmrb/llm#readme">llm.rb</A> it is
      more or less straightforward to build a pipeline that performs image
      analysis in pure Ruby. We can easily adapt this pattern for related
      problems, like emotion detection, captioning, or any task where you want
      a model to ‚Äúsee‚Äù and explain. The building blocks are all there ‚Äì just
      describe what you want, and see what happens.</P>
    </DIV>
  </MAIN>
  <FOOTER>
    <P>This website was generated by <A href="https://go.dev/" target="_blank"
    rel="noopener noreferrer">Golang</A></P>
  </FOOTER>
  <SCRIPT src="/js/main.js"></SCRIPT>
</BODY>
</HTML>
